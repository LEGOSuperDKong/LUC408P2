<!DOCTYPE html>
<html lang="en"> 
<head>
    <script src="http://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<meta charset="utf-8"/>
<title>Ping!</title>
</head>
<body>
<div id="cont">
<center><h2>Login:</h2></center><center>
<label for="user">Username:</label><input id="user" type="text"><br>
<label for="pass">Password:</label><input id="pass" type="text"><br>
 <button type="button" onclick="login();">Login</button><button type="button" onclick="register();">Register</button></center>
</div>
<script>
function login(){
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
if(this.responseText == "true"){
	alert("Logged In.");
	//code here to switch to the logged in screen:
	main();
}else{
	alert("invalid login credentials");
}
}
};
user = document.getElementById("user").value;
pass = document.getElementById("pass").value;
xhttp.open("GET", "user_login.php?id="+user+"&pass="+pass, true);
xhttp.send();
}
function load_chats(){
//code here to load the chats.
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
document.getElementById("chats").innerHTML = this.responseText;
}
};
xhttp.open("GET", "get_chats.php?id="+user+"&pass="+pass, true);
xhttp.send();
}


function main(){
    document.getElementById("cont").innerHTML = '<center><h1>Welcome '+user+'</h1><p>you are now logged in.</p></center><center><table><tr><th id="chats1" width="300" height="550"><button type="button" onclick="stopInterval(going);create_chat();">New Chat</button><h2>Your Chats:</h2><br/><div id="chats"> </div></th><th width="300" height="550" id="viewer"> <iframe width="300" id="iframer" src="blank.html"></iframe><input id="user" type="text"><button type="button" onclick="sendchat();">Send</button></th></tr></table></center>';
    current_cid = 0;
    going = setInterval(load_chats,1000);
    
}
function create_chat(){
    //code here to create the new chat window.
document.getElementById("cont").innerHTML = '<center><h2>Create New Group/Chat:</h2></center><label for="user">Other members, comma seperated:</label><input id="users" type="text"><br><label for="namer">Name of Chat:</label><input id="namer" type="text"><br><button type="button" onclick="create();main();">Create Chat</button></center>';
}
function create(){
    //code here to actually create it.
    namex = document.getElementById("namer").value;
    users = document.getElementById("users").value;
    users = ","+users+",";
    users = ","+user+users;
    users = users.replace(/,/g, "%");
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
}
};
xhttp.open("GET", "create_conversation.php?id="+user+"&pass="+pass+"&users="+users+"&name="+namex, true);
xhttp.send();

    
}
function switchchat(idx){
    current_cid = idx;
    document.getElementById('iframer').src = "view.php?id="+user+"&cid="+idx+"&password="+pass;
}

function register(){
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
eval(this.responseText);
}
};
xhttp.open("GET", "user_registration.php?id="+document.getElementById("user").value+"&pass="+document.getElementById("pass").value, true);
xhttp.send();
}
function sendchat(){
text = document.getElementById("user").value;
document.getElementById("user").value = "";
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
}
};
xhttp.open("GET", "send_chat.php?id="+user+"&pass="+pass+"&cid="+current_cid+"&msg="+text, true);
xhttp.send();
    
}
</script>
</body>
</html>